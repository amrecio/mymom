<?xml version="1.0"?>

<project name="FreeCol" default="package">
  <property environment="env"/>
  <property name="freecol.data.dir" value="${basedir}/data"/>
  <property name="freecol.src.dir" value="${basedir}/src"/>
  <property name="freecol.build.dir" value="${basedir}/src/classes"/>
  <property name="freecol.javadoc.dir" value="${basedir}/javadoc"/>
  <property name="freecol.jar.file" value="${basedir}/FreeCol.jar"/>
  <property name="freecol.overview.file" value="${freecol.src.dir}/overview.html"/>

  <target name="init" unless="TSTAMP">
    <tstamp/>
  </target>

  <target name="compile" depends="init">
    <mkdir dir="${freecol.build.dir}"/>
    <javac srcdir="${freecol.src.dir}"
           destdir="${freecol.build.dir}"
           classpath="${basedir}/jars/higlayout.jar"
           debug="on"
           optimize="on"
           deprecation="off"
           source="1.4"
    />
  </target>

  <target name="copy-sound-files" depends="init" unless="nosound">
    <copy todir="${freecol.build.dir}/net/sf/freecol/data/audio">
      <fileset dir="${freecol.data.dir}/audio">
        <exclude name="**/CVS/**"/>
      </fileset>
    </copy>
  </target>
  
  <target name="copy-jar-files" depends="init" unless="nojars">
    <mkdir dir="${freecol.build.dir}/jars"/>
    <copy todir="${freecol.build.dir}/jars">
      <fileset dir="${basedir}/jars">
        <exclude name="**/CVS/**"/>
      </fileset>
    </copy>
  </target>

  <target name="copy-data-files" depends="init" unless="nodata">
    <!-- Copy the image files -->
    <copy todir="${freecol.build.dir}/net/sf/freecol/data/images">
      <fileset dir="${freecol.data.dir}/images">
        <exclude name="**/CVS/**"/>
      </fileset>
    </copy>

    <copy todir="${freecol.build.dir}/net/sf/freecol/data/fonts">
      <fileset dir="${freecol.data.dir}/fonts">
        <exclude name="**/CVS/**"/>
      </fileset>
    </copy>
    
    <!-- Copy the sound files unless the "nosound" property has been defined -->
    <antcall target="copy-sound-files"/>
  </target>

  <target name="build" depends="init,compile">
    <!-- Copy the data files unless the "nodata" property has been defined -->
    <antcall target="copy-data-files"/>
  	
  	<!-- Copy the jar files unless the "nojars" property has been defined -->
  	<antcall target="copy-jar-files"/>
    
    <copy todir="${freecol.build.dir}">
        <fileset dir="${freecol.src.dir}" includes="**/*.properties"
            excludes="classes/**" />
    </copy>
  </target>

  <target name="package" depends="init,build">
    <jar jarfile="${freecol.jar.file}"
         basedir="${freecol.build.dir}"
         manifest="${basedir}/src/MANIFEST.MF"
         excludes="**/CVS/**, **/metaserver/**"
    />
  </target>
  
  <target name="fullpackage" depends="init,build">
    <jar jarfile="${freecol.jar.file}"
         basedir="${freecol.build.dir}"
         manifest="${basedir}/src/MANIFEST.MF"
         excludes="**/CVS/**"
    />
  </target>

  <target name="clean" depends="init">
    <delete quiet="true" includeEmptyDirs="true">
      <fileset dir="${freecol.build.dir}" includes="net/**" />
      <fileset dir="${freecol.build.dir}" includes="timestamp.inf" />
    </delete>
    <delete quiet="true" file="${freecol.jar.file}"/>
    <delete quiet="true" dir="${freecol.javadoc.dir}"/>
    <delete quiet="true" dir="${freecol.build.dir}"/>
  </target>
  
  <target name="fix" depends="init">
    <fixcrlf srcdir="${freecol.src.dir}"
             includes="**/*.java"
             eol="asis"
             tab="remove"
             javafiles="yes"
             tablength="4"
             eof="asis"
    />
  </target>
  
  <target name="javadoc" depends="init">
    <mkdir dir="${freecol.javadoc.dir}"/>
    <javadoc sourcepath="${freecol.src.dir}"
             overview="${freecol.overview.file}"
             destdir="${freecol.javadoc.dir}"
             packagenames="net.sf.freecol.*"
             Author="true"
             Windowtitle="FreeCol Code Documentation"
    />
  </target>
</project>
